<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports League | Team Offers</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body class="dashboard-body">
    {% include "_banner.html" %}
    <main class="dashboard-container">
        <header class="admin-header">
            <div>
                <p class="eyebrow">Coach Console</p>
                <h1>Transfer Offers for Team Players</h1>
                <p class="subtitle">View offers made to players on your team. Players decide whether to accept or reject.</p>
            </div>
            <div class="admin-actions">
                <a href="{{ url_for('coach.view_team') }}" class="btn solid">‚Üê Back to My Team</a>
            </div>
        </header>

        <!-- Pending Offers Section -->
        <section style="margin-bottom: 2rem;">
            <h2 style="font-size: 1.25rem; margin-bottom: 1rem;">Pending Offers</h2>
            {% if pending_offers %}
            <div class="table-card">
                <table class="simple-table">
                    <thead>
                        <tr>
                            <th>Player</th>
                            <th>Position</th>
                            <th>Requesting Team</th>
                            <th>Requesting Coach</th>
                            <th>Offer Amount</th>
                            <th>Available Until</th>
                            <th>Contract End Date</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for offer in pending_offers %}
                        <tr>
                            <td>
                                <strong>{{ offer.playerfirstname }} {{ offer.playerlastname }}</strong>
                                {% if offer.playeremail %}
                                <br><span class="subtle" style="font-size: 0.85rem;">{{ offer.playeremail }}</span>
                                {% endif %}
                            </td>
                            <td>{{ offer.playerposition }}</td>
                            <td>{{ offer.requestingteamname }}</td>
                            <td>
                                {{ offer.requestingcoachfirstname }} {{ offer.requestingcoachlastname }}
                                {% if offer.requestingcoachemail %}
                                <br><span class="subtle" style="font-size: 0.85rem;">{{ offer.requestingcoachemail }}</span>
                                {% endif %}
                            </td>
                            <td>${{ "{:,.0f}".format(offer.offeramount) }}</td>
                            <td>
                                <strong>{{ offer.availableuntil|strftime('%Y-%m-%d') }}</strong><br>
                                <span class="subtle">{{ offer.availableuntil|strftime('%H:%M') }}</span>
                            </td>
                            <td>
                                {% if offer.offeredenddate %}
                                    <strong>{{ offer.offeredenddate|strftime('%Y-%m-%d') }}</strong><br>
                                    <span class="subtle">{{ offer.offeredenddate|strftime('%H:%M') }}</span>
                                {% else %}
                                    <span class="subtle">N/A</span>
                                {% endif %}
                            </td>
                            <td>
                                <form method="POST" action="{{ url_for('coach.evaluate_team_offer', offer_id=offer.offerid) }}" style="display: inline-flex; gap: 0.5rem;">
                                    <button type="submit" name="decision" value="accept" class="btn solid" style="padding: 0.5rem 1rem;">Accept</button>
                                    <button type="submit" name="decision" value="reject" class="btn solid" style="padding: 0.5rem 1rem; background: #ef4444;">Reject</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="card">
                <p class="subtle">No pending transfer offers at this time.</p>
            </div>
            {% endif %}
        </section>

        <!-- Past Offers Section -->
        <section>
            <h2 style="font-size: 1.25rem; margin-bottom: 1rem;">Past Offers</h2>
            {% if past_offers %}
            <div class="table-card">
                <table class="simple-table">
                    <thead>
                        <tr>
                            <th>Player</th>
                            <th>Position</th>
                            <th>Requesting Team</th>
                            <th>Requesting Coach</th>
                            <th>Offer Amount</th>
                            <th>Available Until</th>
                            <th>Contract End Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for offer in past_offers %}
                        <tr>
                            <td>
                                <strong>{{ offer.playerfirstname }} {{ offer.playerlastname }}</strong>
                                {% if offer.playeremail %}
                                <br><span class="subtle" style="font-size: 0.85rem;">{{ offer.playeremail }}</span>
                                {% endif %}
                            </td>
                            <td>{{ offer.playerposition }}</td>
                            <td>{{ offer.requestingteamname }}</td>
                            <td>
                                {{ offer.requestingcoachfirstname }} {{ offer.requestingcoachlastname }}
                                {% if offer.requestingcoachemail %}
                                <br><span class="subtle" style="font-size: 0.85rem;">{{ offer.requestingcoachemail }}</span>
                                {% endif %}
                            </td>
                            <td>${{ "{:,.0f}".format(offer.offeramount) }}</td>
                            <td>
                                <strong>{{ offer.availableuntil|strftime('%Y-%m-%d') }}</strong><br>
                                <span class="subtle">{{ offer.availableuntil|strftime('%H:%M') }}</span>
                            </td>
                            <td>
                                {% if offer.offeredenddate %}
                                    <strong>{{ offer.offeredenddate|strftime('%Y-%m-%d') }}</strong><br>
                                    <span class="subtle">{{ offer.offeredenddate|strftime('%H:%M') }}</span>
                                {% else %}
                                    <span class="subtle">N/A</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if offer.availableuntil < now %}
                                    <span class="status-badge" style="background: #fee2e2; color: #991b1b;">Expired</span>
                                {% elif offer.offerstatus == True or offer.offerstatus == 1 %}
                                    <span class="status-badge eligible">Accepted</span>
                                {% elif offer.offerstatus == False or offer.offerstatus == 0 %}
                                    <span class="status-badge ineligible">Rejected</span>
                                {% else %}
                                    <span class="status-badge" style="background: #f3f4f6; color: #6b7280;">Unknown</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="card">
                <p class="subtle">No past transfer offers.</p>
            </div>
            {% endif %}
        </section>

        <!-- Sent Offers Section -->
        <section style="margin-top: 2rem;">
            <h2 style="font-size: 1.25rem; margin-bottom: 1rem;">Sent Offers</h2>
            <p class="subtle" style="margin-bottom: 1rem;">Offers sent by coaches from your team to players on other teams.</p>
            {% if sent_offers %}
            <div class="table-card">
                <table class="simple-table">
                    <thead>
                        <tr>
                            <th>Player</th>
                            <th>Position</th>
                            <th>Player's Team</th>
                            <th>Sent By Coach</th>
                            <th>Offer Amount</th>
                            <th>Available Until</th>
                            <th>Contract End Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for offer in sent_offers %}
                        <tr>
                            <td>
                                <strong>{{ offer.playerfirstname }} {{ offer.playerlastname }}</strong>
                                {% if offer.playeremail %}
                                <br><span class="subtle" style="font-size: 0.85rem;">{{ offer.playeremail }}</span>
                                {% endif %}
                            </td>
                            <td>{{ offer.playerposition }}</td>
                            <td>
                                {% if offer.playerteamname %}
                                    {{ offer.playerteamname }}
                                {% else %}
                                    <span class="subtle">No team</span>
                                {% endif %}
                            </td>
                            <td>
                                {{ offer.requestingcoachfirstname }} {{ offer.requestingcoachlastname }}
                                {% if offer.requestingcoachemail %}
                                <br><span class="subtle" style="font-size: 0.85rem;">{{ offer.requestingcoachemail }}</span>
                                {% endif %}
                            </td>
                            <td>${{ "{:,.0f}".format(offer.offeramount) }}</td>
                            <td>
                                <strong>{{ offer.availableuntil|strftime('%Y-%m-%d') }}</strong><br>
                                <span class="subtle">{{ offer.availableuntil|strftime('%H:%M') }}</span>
                            </td>
                            <td>
                                {% if offer.offeredenddate %}
                                    <strong>{{ offer.offeredenddate|strftime('%Y-%m-%d') }}</strong><br>
                                    <span class="subtle">{{ offer.offeredenddate|strftime('%H:%M') }}</span>
                                {% else %}
                                    <span class="subtle">N/A</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if offer.availableuntil < now %}
                                    <span class="status-badge" style="background: #fee2e2; color: #991b1b;">Expired</span>
                                {% elif offer.offerstatus is none %}
                                    <span class="status-badge" style="background: #fef3c7; color: #92400e;">Pending</span>
                                {% elif offer.offerstatus == True or offer.offerstatus == 1 %}
                                    <span class="status-badge eligible">Accepted</span>
                                {% elif offer.offerstatus == False or offer.offerstatus == 0 %}
                                    <span class="status-badge ineligible">Rejected</span>
                                {% else %}
                                    <span class="status-badge" style="background: #f3f4f6; color: #6b7280;">Unknown</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="card">
                <p class="subtle">No sent transfer offers.</p>
            </div>
            {% endif %}
        </section>
    </main>
</body>
</html>

