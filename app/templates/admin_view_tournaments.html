<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | View Tournaments</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body class="dashboard-body">
    {% include "_banner.html" %}
    <main class="dashboard-container">
        <header class="admin-header">
            <div>
                <p class="eyebrow">Admin Console</p>
                <h1>View Tournaments</h1>
            </div>
            <div class="admin-actions">
                {% if allow_create %}
                <a class="add-tournament-link" href="{{ url_for(create_endpoint) }}">+ Add Tournament</a>
                {% endif %}
                
            </div>
        </header>

        <section class="tournaments-layout">
            <aside class="tournament-sidebar">
                <div class="sidebar-header">
                    <h2>Tournaments</h2>
                </div>
                {% if tournaments %}
                <ul class="tournament-list">
                    {% for tournament in tournaments %}
                    {% set is_selected = selected_tournament and tournament.tournamentid == selected_tournament.tournamentid %}
                    <li>
                        <a class="tournament-pill {{ 'selected' if is_selected }}" href="{{ url_for(list_endpoint, tournament_id=tournament.tournamentid) }}">
                            <span class="pill-avatar">A</span>
                            <div>
                                <p class="pill-name">{{ tournament.name }}</p>
                                {% if is_selected %}
                                <p class="pill-meta">Selected</p>
                                {% else %}
                                <p class="pill-meta">{{ tournament.size or 'Unknown size' }}</p>
                                {% endif %}
                            </div>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="empty-state">No tournaments assigned to you yet.</p>
                {% endif %}

                
            </aside>

            <section class="bracket-panel">
                {% if not selected_tournament %}
                <div class="empty-bracket">Select a tournament to see the bracket.</div>
                {% elif not matches_by_round %}
                <div class="empty-bracket">No bracket has been created for {{ selected_tournament.name }}.</div>
                {% else %}
                <div class="bracket-card">
                    {% for level, rounds in matches_by_round.items() %}
                    <div class="bracket-level">
                        <h3>Level {{ level }}{% if level == 1 %} (Root){% endif %}</h3>
                        <div class="level-rounds">
                            {% for round_data in rounds %}
                            <div class="round-box">
                                <div class="round-header">
                                    <p class="round-number">Round {{ round_data.roundno }}</p>
                                    {% if round_data.parentroundno %}
                                    <p class="round-meta">Parent: {{ round_data.parentroundno }}</p>
                                    {% else %}
                                    <p class="round-meta">ROOT</p>
                                    {% endif %}
                                </div>
                                
                                {% if round_data.matchid %}
                                <div class="round-match">
                                    <div class="match-team">
                                        <span>{{ round_data.hometeamname or 'TBD' }}</span>
                                        <span class="score">{{ round_data.hometeamscore if round_data.hometeamscore is not none else '-' }}</span>
                                    </div>
                                    <div class="match-divider">vs</div>
                                    <div class="match-team">
                                        <span>{{ round_data.awayteamname or 'TBD' }}</span>
                                        <span class="score">{{ round_data.awayteamscore if round_data.awayteamscore is not none else '-' }}</span>
                                    </div>
                                    <p class="match-time">{{ round_data.matchstartdatetime.strftime('%Y-%m-%d %H:%M') if round_data.matchstartdatetime else 'TBD' }}</p>
                                </div>
                                {% else %}
                                <div class="round-empty">
                                    <p>No match</p>
                                    {% if round_data.child1roundno or round_data.child2roundno %}
                                    <p class="children-info">
                                        Children: 
                                        {% if round_data.child1roundno %}{{ round_data.child1roundno }}{% endif %}
                                        {% if round_data.child2roundno %}, {{ round_data.child2roundno }}{% endif %}
                                    </p>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </section>
        </section>
    </main>
</body>
</html>
