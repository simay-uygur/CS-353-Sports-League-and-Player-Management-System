<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports League | Player Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body class="dashboard-body">
    {% include "_banner.html" %}
    <main class="dashboard-container">
        <header class="player-header">
            <div class="player-header__left">
                <h1>{{ player_info.firstname }} {{ player_info.lastname }}</h1>
                {% if player_info.iseligible and player_info.iseligible|lower == 'eligible' %}
                    <span class="status-badge eligible">
                        Status: Eligible
                    </span>
                {% else %}
                    <span class="status-badge ineligible" style="background-color: #fee2e2; color: #991b1b;">
                        Status: {{ player_info.iseligible or 'Unknown' }}
                    </span>
                {% endif %}
            </div>
        </header>

        <div class="player-dashboard-grid">
            <!-- Left Column -->
            <div class="player-dashboard__left">
                <!-- Upcoming Trainings -->
                <section class="dashboard-card">
                    <div class="card-header-with-link">
                        <h2>Upcoming Trainings</h2>
                        <a href="{{ url_for('player.view_trainings') }}" class="view-all-link">See All â†’</a>
                    </div>
                    <div class="training-list">
                        <p class="subtle">No upcoming trainings scheduled.</p>
                    </div>
                </section>

                <!-- Offers and Invites -->
                <section class="dashboard-card">
                    <div class="card-header-with-link">
                        <h2>Offers and Invites</h2>
                        <a href="{{ url_for('player.view_offers') }}" class="view-all-link">See All â†’</a>
                    </div>
                    <p class="subtle">See your pending offers and invites.</p>
                </section>

                <!-- My Team -->
                <section class="dashboard-card">
                    <div class="card-header-with-link">
                        <h2>My Team</h2>
                        <a href="{{ url_for('player.view_team') }}" class="view-all-link">View Team â†’</a>
                    </div>
                    <p class="subtle">View your team information and teammates.</p>
                </section>
            </div>

            <!-- Right Column -->
            <div class="player-dashboard__right">
                <!-- Statistics Section -->
                <section class="dashboard-card">
                    <h2>Statistics</h2>
                    
                    <!-- Summary Cards -->
                    {% if overall_stats %}
                    <div class="stats-cards-grid">
                        <div class="stat-card">
                            <div class="stat-card__icon">ðŸ“Š</div>
                            <div class="stat-card__value">{{ overall_stats.total_appearances or 0 }}</div>
                            <div class="stat-card__label">Matches</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card__icon">ðŸŸ¨</div>
                            <div class="stat-card__value">{{ overall_stats.total_yellowcards or 0 }}</div>
                            <div class="stat-card__label">Yellow Cards</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card__icon">âš½</div>
                            <div class="stat-card__value">{{ overall_stats.total_assistsmade or 0 }}</div>
                            <div class="stat-card__label">Assists</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card__icon">ðŸŽ¯</div>
                            <div class="stat-card__value">{{ overall_stats.total_goals or 0 }}</div>
                            <div class="stat-card__label">Goals</div>
                        </div>
                    </div>
                    {% else %}
                    <p class="subtle">No statistics available yet.</p>
                    {% endif %}

                    <!-- Filter Form -->
                    <div class="stats-filter-form">
                        <h3>View Season Statistics</h3>
                        <form method="GET" action="{{ url_for('player.home') }}" class="filter-form">
                            <div class="form-row">
                                <label for="league_id">League</label>
                                <select name="league_id" id="league_id">
                                    <option value="">All Leagues</option>
                                    {% for league in available_leagues %}
                                    <option value="{{ league.leagueid }}" {% if selected_league_id == league.leagueid %}selected{% endif %}>
                                        {{ league.leaguename }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-row">
                                <label for="season_no">Season No</label>
                                <input type="number" name="season_no" id="season_no" min="1" value="{{ selected_season_no or '' }}" placeholder="e.g. 1">
                            </div>
                            <div class="form-row">
                                <label for="season_year">Season Year</label>
                                <input type="date" name="season_year" id="season_year" value="{{ selected_season_year or '' }}">
                            </div>
                            <div class="form-row">
                                <button type="submit" class="btn solid">View Statistics</button>
                                {% if selected_league_id or selected_season_no or selected_season_year %}
                                <a href="{{ url_for('player.home') }}" class="btn ghost">Clear Filters</a>
                                {% endif %}
                            </div>
                        </form>
                    </div>

                    <!-- Season-Specific Statistics Table -->
                    {% if season_stats %}
                    <div class="stats-detail-table">
                        <h3>Season Statistics</h3>
                        {% if season_stats|length > 0 %}
                        <div class="table-card">
                            <table class="simple-table">
                                <thead>
                                    <tr>
                                        <th>League</th>
                                        <th>Season</th>
                                        <th>Appearances</th>
                                        <th>Goals</th>
                                        <th>Assists</th>
                                        <th>Yellow Cards</th>
                                        <th>Red Cards</th>
                                        <th>Minutes</th>
                                        <th>Penalties</th>
                                        <th>Saves</th>
                                        <th>Passes (Suc/Total)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for stat in season_stats %}
                                    <tr>
                                        <td>{{ stat.name }}</td>
                                        <td>{{ stat.seasonno }} ({{ stat.seasonyear }})</td>
                                        <td>{{ stat.total_appearances or 0 }}</td>
                                        <td>{{ stat.total_goals or 0 }}</td>
                                        <td>{{ stat.total_assistsmade or 0 }}</td>
                                        <td>{{ stat.total_yellowcards or 0 }}</td>
                                        <td>{{ stat.total_redcards or 0 }}</td>
                                        <td>{{ "%.0f"|format(stat.total_minutes or 0) }}</td>
                                        <td>{{ stat.total_penalties or 0 }}</td>
                                        <td>{{ stat.total_saves or 0 }}</td>
                                        <td>{{ stat.total_successfulpasses or 0 }} / {{ stat.total_totalpasses or 0 }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <p class="subtle">No statistics found for the selected season.</p>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- Tournament Statistics -->
                    {% if tournament_stats %}
                    <div class="stats-detail-table">
                        <h3>Tournament Statistics</h3>
                        <div class="table-card">
                            <table class="simple-table">
                                <thead>
                                    <tr>
                                        <th>Tournament</th>
                                        <th>Appearances</th>
                                        <th>Goals</th>
                                        <th>Assists</th>
                                        <th>Yellow Cards</th>
                                        <th>Red Cards</th>
                                        <th>Minutes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for stat in tournament_stats %}
                                    <tr>
                                        <td>{{ stat.name }}</td>
                                        <td>{{ stat.total_appearances or 0 }}</td>
                                        <td>{{ stat.total_goals or 0 }}</td>
                                        <td>{{ stat.total_assistsmade or 0 }}</td>
                                        <td>{{ stat.total_yellowcards or 0 }}</td>
                                        <td>{{ stat.total_redcards or 0 }}</td>
                                        <td>{{ "%.0f"|format(stat.total_minutes or 0) }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {% endif %}
                </section>
            </div>
        </div>
    </main>
</body>
</html>
