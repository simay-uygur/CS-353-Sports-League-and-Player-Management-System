<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports League | My Offers</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body class="dashboard-body">
    {% include "_banner.html" %}
    <main class="dashboard-container">
        <header class="admin-header">
            <div>
                <p class="eyebrow">Player Dashboard</p>
                <h1>My Offers & Invites</h1>
                <p class="subtitle">View offers made to you when you were a free agent (not on any team).</p>
            </div>
        </header>

        <!-- Pending Offers Section -->
        <section style="margin-bottom: 2rem;">
            <h2 style="font-size: 1.25rem; margin-bottom: 1rem;">Pending Offers</h2>
            {% if pending_offers %}
            <div class="table-card">
                <table class="simple-table">
                    <thead>
                        <tr>
                            <th>From Team</th>
                            <th>Requesting Coach</th>
                            <th>Offer Amount</th>
                            <th>Available Until</th>
                            <th>Contract End Date</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for offer in pending_offers %}
                        <tr>
                            <td>{{ offer.teamname }}</td>
                            <td>{{ offer.requestingcoachfirstname }} {{ offer.requestingcoachlastname }}</td>
                            <td>${{ "{:,.0f}".format(offer.offeramount) }}</td>
                            <td>
                                <strong>{{ offer.availableuntil|strftime('%Y-%m-%d') }}</strong><br>
                                <span class="subtle">{{ offer.availableuntil|strftime('%H:%M') }}</span>
                            </td>
                            <td>
                                {% if offer.offeredenddate %}
                                    <strong>{{ offer.offeredenddate|strftime('%Y-%m-%d') }}</strong><br>
                                    <span class="subtle">{{ offer.offeredenddate|strftime('%H:%M') }}</span>
                                {% else %}
                                    <span class="subtle">N/A</span>
                                {% endif %}
                            </td>
                            <td>
                                <form method="POST" action="{{ url_for('player.evaluate_offer', offer_id=offer.offerid) }}" style="display: inline-flex; gap: 0.5rem;">
                                    <button type="submit" name="decision" value="accept" class="btn solid" style="padding: 0.5rem 1rem;">Accept</button>
                                    <button type="submit" name="decision" value="reject" class="btn solid" style="padding: 0.5rem 1rem; background: #ef4444;">Reject</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="card">
                <p class="subtle">No pending transfer offers at this time.</p>
            </div>
            {% endif %}
        </section>

        <!-- Past Offers Section -->
        <section>
            <h2 style="font-size: 1.25rem; margin-bottom: 1rem;">Past Offers</h2>
            {% if past_offers %}
            <div class="table-card">
                <table class="simple-table">
                    <thead>
                        <tr>
                            <th>From Team</th>
                            <th>Requesting Coach</th>
                            <th>Offer Amount</th>
                            <th>Available Until</th>
                            <th>Contract End Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for offer in past_offers %}
                        <tr>
                            <td>{{ offer.teamname }}</td>
                            <td>{{ offer.requestingcoachfirstname }} {{ offer.requestingcoachlastname }}</td>
                            <td>${{ "{:,.0f}".format(offer.offeramount) }}</td>
                            <td>
                                <strong>{{ offer.availableuntil|strftime('%Y-%m-%d') }}</strong><br>
                                <span class="subtle">{{ offer.availableuntil|strftime('%H:%M') }}</span>
                            </td>
                            <td>
                                {% if offer.offeredenddate %}
                                    <strong>{{ offer.offeredenddate|strftime('%Y-%m-%d') }}</strong><br>
                                    <span class="subtle">{{ offer.offeredenddate|strftime('%H:%M') }}</span>
                                {% else %}
                                    <span class="subtle">N/A</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if offer.availableuntil < now %}
                                    <span class="status-badge" style="background: #fee2e2; color: #991b1b;">Expired</span>
                                {% elif offer.offerstatus == True or offer.offerstatus == 1 %}
                                    <span class="status-badge eligible">Accepted</span>
                                {% elif offer.offerstatus == False or offer.offerstatus == 0 %}
                                    <span class="status-badge ineligible">Rejected</span>
                                {% else %}
                                    <span class="status-badge" style="background: #f3f4f6; color: #6b7280;">Unknown</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="card">
                <p class="subtle">No past transfer offers.</p>
            </div>
            {% endif %}
        </section>
    </main>
</body>
</html>

