{% extends "base.html" %}

{% block content %}
<h2>Assigned Matches</h2>

<div class="card">
  <div class="filters">
    <select id="seasonFilter">
      <option>Select Season</option>
    </select>
    <select id="leagueFilter">
      <option>Select League</option>
    </select>
    <select id="teamFilter">
      <option>Select Team</option>
    </select>
    <button class="btn btn-dark" onclick="fetchMatches()">Filter</button>
  </div>
</div>

<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Time</th>
      <th>Teams</th>
      <th>Competition</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="matchesBody">
  </tbody>
</table>
{% endblock %}

{% block scripts %}
<script>
  // Hardcoded Referee ID for demo purposes
  const REF_ID = 29;

  async function fetchMatches() {
    // Calls the API defined in Source [1002]
    const response = await fetch(`${API_BASE}/referee/matches?referee_id=${REF_ID}`);
    const matches = await response.json();

    const tbody = document.getElementById('matchesBody');
    tbody.innerHTML = '';

    matches.forEach(match => {
      const row = `
                <tr>
                    <td>${new Date(match.matchstartdatetime).toLocaleDateString()}</td>
                    <td>${new Date(match.matchstartdatetime).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})}</td>
                    <td>${match.hometeamname} vs. ${match.awayteamname}</td>
                    <td>${match.competition_name}</td>
                    <td>
                        <a href="/ui/match/${match.matchid}" class="btn btn-dark">Enter Match Info</a>
                    </td>
                </tr>
            `;
      tbody.innerHTML += row;
    });
  }

  // Load on start
  fetchMatches();
</script>
{% endblock %}
