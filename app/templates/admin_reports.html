<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | Reports</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body class="dashboard-body">
    {% include "_banner.html" %}
    <main class="dashboard-container">
        <header class="admin-header">
            <div>
                <p class="eyebrow">Admin Console</p>
                <h1>Reports</h1>
                {% if error_message %}
                <p class="form-message error">{{ error_message }}</p>
                {% endif %}
            </div>
        </header>

        <section class="reports-grid">
            <div class="card">
                <h3>Player Report</h3>
                <form method="POST">
                    <input type="hidden" name="report_type" value="players">
                    <label>Player ID (optional)</label>
                    <input type="number" name="player_id" placeholder="e.g. 12">

                    <label class="checkbox-field">
                        <input type="checkbox" name="currently_employed">
                        <span>Currently employed</span>
                    </label>

                    <label>Employed before</label>
                    <input type="datetime-local" name="employed_before">

                    <label>Employed after</label>
                    <input type="datetime-local" name="employed_after">

                    <label>Employment ended before</label>
                    <input type="datetime-local" name="ended_before">

                    <label>Employment ended after</label>
                    <input type="datetime-local" name="ended_after">

                    <button type="submit" class="btn solid">Generate</button>
                </form>
            </div>

            <div class="card">
                <h3>League Standings</h3>
                <form method="POST">
                    <input type="hidden" name="report_type" value="standings">
                    <label>League</label>
                    <select name="league_id" required>
                        <option value="">Select league</option>
                        {% for l in leagues %}
                        <option value="{{ l.leagueid }}">{{ l.name }}</option>
                        {% endfor %}
                    </select>
                    <label>Season No</label>
                    <input type="number" name="season_no" required min="1">
                    <label>Season Year</label>
                    <input type="date" name="season_year" required>
                    <button type="submit" class="btn solid">Generate</button>
                </form>
            </div>

            <div class="card">
                <h3>Player Attendance</h3>
                <form method="POST">
                    <input type="hidden" name="report_type" value="attendance">
                    <label>League (optional)</label>
                    <select name="league_id">
                        <option value="">All leagues</option>
                        {% for l in leagues %}
                        <option value="{{ l.leagueid }}">{{ l.name }}</option>
                        {% endfor %}
                    </select>
                    <label>Season No (optional)</label>
                    <input type="number" name="season_no" min="1">
                    <label>Season Year (optional)</label>
                    <input type="date" name="season_year">
                    <button type="submit" class="btn solid">Generate</button>
                </form>
            </div>
        </section>

        {% if players_report is not none %}
        <section class="report-table">
            <h3>Player Report Results</h3>
            {% if players_report %}
            <div class="report-actions">
                <form method="POST" action="{{ url_for('admin.download_report_pdf') }}" class="inline-form">
                    <input type="hidden" name="report_type" value="players">
                    <input type="hidden" name="player_id" value="{{ request.form.get('player_id', '') }}">
                    <input type="hidden" name="currently_employed" value="{{ 1 if request.form.get('currently_employed') else '' }}">
                    <input type="hidden" name="employed_before" value="{{ request.form.get('employed_before', '') }}">
                    <input type="hidden" name="employed_after" value="{{ request.form.get('employed_after', '') }}">
                    <input type="hidden" name="ended_before" value="{{ request.form.get('ended_before', '') }}">
                    <input type="hidden" name="ended_after" value="{{ request.form.get('ended_after', '') }}">
                    <button type="submit" class="btn solid btn-small">Download PDF</button>
                </form>
            </div>
            <div class="table-card">
                <table class="simple-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Position</th>
                            <th>Team</th>
                            <th>Start</th>
                            <th>End</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in players_report %}
                        <tr>
                            <td>{{ p.firstname }} {{ p.lastname }}</td>
                            <td>{{ p.email }}</td>
                            <td>{{ p.position }}</td>
                            <td>{{ p.teamname or 'Unassigned' }}</td>
                            <td>{{ p.startdate|strftime('%Y-%m-%d') if p.startdate else '' }}</td>
                            <td>{{ p.enddate|strftime('%Y-%m-%d') if p.enddate else '' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="subtle">No results.</p>
            {% endif %}
        </section>
        {% endif %}

        {% if standings_report is not none %}
        <section class="report-table">
            <h3>League Standings</h3>
            {% if standings_report %}
            <div class="report-actions">
                <form method="POST" action="{{ url_for('admin.download_report_pdf') }}" class="inline-form">
                    <input type="hidden" name="report_type" value="standings">
                    <input type="hidden" name="league_id" value="{{ request.form.get('league_id', '') }}">
                    <input type="hidden" name="season_no" value="{{ request.form.get('season_no', '') }}">
                    <input type="hidden" name="season_year" value="{{ request.form.get('season_year', '') }}">
                    <button type="submit" class="btn solid btn-small">Download PDF</button>
                </form>
            </div>
            <div class="table-card">
                <table class="simple-table">
                    <thead>
                        <tr>
                            <th>Team</th>
                            <th>Pts</th>
                            <th>W</th>
                            <th>D</th>
                            <th>L</th>
                            <th>GF</th>
                            <th>GA</th>
                            <th>GD</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in standings_report %}
                        <tr>
                            <td>{{ row.teamname }}</td>
                            <td>{{ row.points }}</td>
                            <td>{{ row.wins }}</td>
                            <td>{{ row.draws }}</td>
                            <td>{{ row.losses }}</td>
                            <td>{{ row.gf }}</td>
                            <td>{{ row.ga }}</td>
                            <td>{{ row.gf - row.ga }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="subtle">No results.</p>
            {% endif %}
        </section>
        {% endif %}

        {% if attendance_report is not none %}
        <section class="report-table">
            <h3>Player Attendance</h3>
            {% if attendance_report %}
            <div class="report-actions">
                <form method="POST" action="{{ url_for('admin.download_report_pdf') }}" class="inline-form">
                    <input type="hidden" name="report_type" value="attendance">
                    <input type="hidden" name="league_id" value="{{ request.form.get('league_id', '') }}">
                    <input type="hidden" name="season_no" value="{{ request.form.get('season_no', '') }}">
                    <input type="hidden" name="season_year" value="{{ request.form.get('season_year', '') }}">
                    <button type="submit" class="btn solid btn-small">Download PDF</button>
                </form>
            </div>
            <div class="table-card">
                <table class="simple-table">
                    <thead>
                        <tr>
                            <th>Player</th>
                            <th>Appearances</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in attendance_report %}
                        <tr>
                            <td>{{ row.firstname }} {{ row.lastname }}</td>
                            <td>{{ row.appearances }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="subtle">No results.</p>
            {% endif %}
        </section>
        {% endif %}
    </main>

    <style>
        .report-actions {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 0.75rem;
        }

        .inline-form {
            display: inline-flex;
            gap: 0.5rem;
            align-items: center;
        }

        /* Remove number spinners for report filters */
        .reports-grid input[type="number"]::-webkit-outer-spin-button,
        .reports-grid input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .reports-grid input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
</body>
</html>
